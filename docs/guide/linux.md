# Linuxä½¿ç”¨è¯´æ˜

##  ç›®å‰ç³»ç»Ÿå…¼å®¹æ€§

* ã€ğŸ†—ã€‘Linux X86
* ã€ğŸ†—ã€‘Linux X64
* ã€ğŸ†—ã€‘Linux Arm64V8

## æ‰‹å·¥é…ç½®

1. ä¸‹è½½å®‰è£…åŒ…
- æœ€æ–°ç‰ˆä¸‹è½½åœ°å€
- å†å²ç‰ˆæœ¬å­˜æ¡£

æˆ–è€…å‘½ä»¤è¡Œä¸‹è½½

```
wget https://download.happyn.cn/linux/happynet-linux-x86-x64-dynamic-all-latest.tar.gz --no-check-certificate
```
## å®‰è£…

1. ä¸‹è½½å®Œæ¯•åè§£å‹æ–‡ä»¶

```
tar zxvf happynet-linux-x86-x64-dynamic-all-latest.tar.gz
```

2. é»˜è®¤åŒ…å«x64åŠx86ã€arm64v8å¤šä¸ªå¹³å°ï¼Œé€‰æ‹©æ‚¨æ‰€åœ¨çš„å¹³å°æ‹·è´æ–‡ä»¶å³å¯(å¦‚æœä¸ç¡®å®šï¼Œé€‰æ‹©x64å³å¯)
```
# è¿›å…¥è§£å‹æ–‡ä»¶å¤¹
$ cd happynlinux

# æ‹·è´å¯æ‰§è¡Œæ–‡ä»¶
$ sudo cp bin/x64/happynet /usr/local/bin/
$ sudo chmod +x /usr/local/bin/happynet

# æ‹·è´é…ç½®æ–‡ä»¶
$ sudo  cp etc/happynet.conf /etc/

# æ‹·è´ç³»ç»ŸæœåŠ¡æ–‡ä»¶
$ sudo cp service/happynet.service /etc/systemd/system/

# è½½å…¥æœåŠ¡
$ sudo systemctl daemon-reload

# å¦‚æœè¦è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼Œè¯·æ‰§è¡Œ
$ sudo systemctl enable happynet
```

3. ä¿®æ”¹é…ç½®æ–‡ä»¶,æ‚¨éœ€è¦å¡«å…¥çš„4ä¸ªå‚æ•°(ä»æ‚¨çš„happyn webç«¯åå°ç™»å½•å¯ä»¥è·å–):

  æ›´è¯¦ç»†çš„å‚æ•°è¯´æ˜è¯·å‚è€ƒ å»ºç«‹Webè´¦æˆ·
```
$ sudo vi /etc/happynet.conf

#==============================
#å¿…æ”¹å‚æ•°:è¿™é‡Œå¡«å…¥æ‚¨è·å–çš„æœåŠ¡ID
-c=VIP0xxxxx

#å¿…æ”¹å‚æ•°:è¿™é‡Œå¡«å…¥æ‚¨è·å–çš„æœåŠ¡å¯†é’¥
-k=1c20743f

#è¿™é‡Œå¡«å…¥æ‚¨æŒ‡å®šçš„ç½‘å¡MACåœ°å€ï¼Œå¦‚æœä¸éœ€è¦æ‰‹å·¥æŒ‡å®šçš„è¯ï¼Œç›´æ¥ç”¨ `#` æ³¨é‡Šæ‰å³å¯
#-m=xx:xx:xx:xx:xx:xx

#å¿…æ”¹å‚æ•°:è¿™é‡Œå¡«å…¥æ‚¨çš„åˆæ³•å­ç½‘IPåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¸èƒ½ä¸å…¶å®ƒè¿å…¥è®¾å¤‡ç›¸å†²çªï¼Œå¦‚æœæƒ³è¦è‡ªåŠ¨è·å–ipï¼Œç›´æ¥ç”¨ `#` æ³¨é‡Šæ‰å³å¯
-a=10.251.56.100

#å¿…æ”¹å‚æ•°:è¿™é‡Œå¡«å…¥æ‚¨çš„ `æœåŠ¡å™¨åœ°å€:ç«¯å£`
-l=vip00.happyn.cc:30002

#å¯ç”¨æ•°æ®å‹ç¼©ï¼ŒèŠ‚çº¦ä¼ è¾“æµé‡ï¼Œå»ºè®®å¼€å¯
-z1

#æœ¬åœ°è½¬å‘ï¼Œé»˜è®¤å…³é—­
#-r

#æŒ‡å®šåŠ å¯†æ–¹æ³•ï¼Œè”å…¥åŒä¸€ç½‘ç»œçš„æœºå™¨å¿…é¡»é‡‡ç”¨åŒä¸€ç§åŠ å¯†æ–¹æ³•
#-A2ä»£è¡¨Twofish, -A3ä»£è¡¨AES (happynæŒ‡å®šé»˜è®¤åŠ å¯†é€‰é¡¹)
#-A4ä»£è¡¨ChaCha20, -A5ä»£è¡¨Speck-CTR
-A3

#å¯é€‰å‚æ•°ï¼šæŒ‡å®šæ‰“æ´å¯¹å¤–ç›‘å¬ç«¯å£ï¼Œå½“æ‚¨éœ€è¦é…ç½®é˜²ç«å¢™æ—¶ï¼Œå¯ä»¥å›ºå®šæ­¤ç«¯å£ï¼Œè¿™æ ·æ–¹ä¾¿é…ç½®é˜²ç«å¢™è§„åˆ™(UDP)
-p=0.0.0.0:55644

#è°ƒè¯•ä¿¡æ¯è¾“å‡ºï¼Œé»˜è®¤å…³é—­
#-vvv
```
4. æ›´å¤šé«˜çº§é…ç½®è¯·å‚è€ƒ:Linuxé«˜çº§é…ç½®

5. è®¾å®šå‚æ•°å®Œæ¯•åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨:

```
$ sudo systemctl start happynet
```

6. æŸ¥çœ‹çŠ¶æ€
```
$ sudo systemctl status happynet
```
å¦‚æœçœ‹åˆ°
"[OK] Edge Peer <<< ================ >>> Super Node"ï¼Œ
è¡¨ç¤ºå·²ç»æˆåŠŸåŠ å…¥å­ç½‘

7. æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªåä¸º edge0çš„è™šæ‹Ÿç½‘å¡
```
$ sudo ip addr

 edge0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1290 qdisc pfifo_fast state UNKNOWN group default qlen 1000
    link/ether 8a:a4:b8:9c:0d:ac brd ff:ff:ff:ff:ff:ff
    inet 10.251.56.100/24 brd 10.251.56.255 scope global edge0
       valid_lft forever preferred_lft forever
    inet6 fe80::88a4:b8ff:fe9c:dac/64 scope link
       valid_lft forever preferred_lft forever
```

## æŸ¥çœ‹log
```
journalctl -f _SYSTEMD_UNIT=happynet.service

#æˆ–è€…æŒ‡å®šçœ‹æœ€å50è¡Œlog
journalctl -n 50 -f  -u happynet
```

## æŸ¥çœ‹ç½‘ç»œè¿è¡ŒçŠ¶å†µ

å¦‚æœæ‚¨æƒ³è¦ç›‘æ§å½“å‰ç½‘ç»œæ‰€æœ‰åœ¨çº¿è®¾å¤‡ï¼Œè¯·åœ¨Linuxç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ `netcat -u 127.0.0.1 5644` ï¼› ç„¶åæŒ‰ä¸¤ä¸‹å›è½¦ï¼Œä¼šçœ‹åˆ°å½“å‰è®¾å¤‡åˆ—è¡¨ï¼›
å…¶ä¸­æœ‰ä¸€æ  `Peer To Peer`ä»£è¡¨P2Pï¼Œ`Supernode Forward`ä»£è¡¨ä¸­è½¬ï¼›

è¯¦ç»†æ“ä½œè¯·å‚è€ƒ:âœï¸Linuxæ•…éšœæ’æŸ¥

## ç›´æ¥å‘½ä»¤è¡Œè¿è¡Œ
å½“å®Œæˆé…ç½®åï¼Œå¦‚æœæ‚¨ä¸å¸Œæœ›ä»¥systemdæœåŠ¡çš„æ–¹å¼å¯åŠ¨ï¼Œå¯ä»¥ç›´æ¥å‘½ä»¤è¡Œè¿è¡Œ:

1. å¯åŠ¨å‘½ä»¤

```
(å¯åŠ¨åè‡ªåŠ¨åå°è¿è¡Œ)

/usr/local/bin/happynet /etc/happynet.conf

(å¯åŠ¨åå‰å°è¿è¡Œ)

/usr/local/bin/happynet /etc/happynet.conf -f
```
2. åœæ­¢å‘½ä»¤
```
ps aux|grep happynet|grep -v grep|awk '{print $2}'|xargs kill  -SIGINT
```

## Dockerå®¹å™¨æ–¹å¼è¿è¡Œ

* ã€ğŸ†—ã€‘Linux X64
* ã€ğŸ†—ã€‘Linux Arm64V8

1. å¯åŠ¨å‘½ä»¤
```
$ sudo docker run -d --restart=always --hostname=happyndocker \
        --privileged --net=host --name happynet happyn/happynet happynet \
        -a <ip> \
        -c <æœåŠ¡ID> \
        -k <æœåŠ¡å¯†é’¥> \
        -l <æœåŠ¡å™¨åœ°å€>:<ç«¯å£> \
        -z1  --select-rtt  -f
```

ç¤ºä¾‹
```
$ sudo docker run -d --restart=always --hostname=happyndocker \
        --privileged --net=host --name happynet happyn/happynet  happynet \
        -a 10.9.9.1 \
        -c VIP0xxxx \
        -k mypass \
        -l vip00.happyn.cc:40000 \
        -z1  --select-rtt  -f
```
æŸ¥çœ‹log
```
docker logs -f happynet
```

## åœ¨PVEçš„LXCå®¹å™¨ä¸­è¿è¡Œ

PVE7.xç³»ç»Ÿï¼Œæ”¯æŒLXCå®¹å™¨æ¨¡æ‹ŸTUNè®¾å¤‡ï¼›åªéœ€è¦åœ¨LXCå®¹å™¨é…ç½®æ–‡ä»¶ (ä¸€èˆ¬ä½ç½®åœ¨ /etc/pve/lxc/1xx.conf )çš„æœ«å°¾åŠ å…¥å¦‚ä¸‹é…ç½®é¡¹:

```
lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file
lxc.cgroup2.devices.allow: c 10:200 rwm
```

ä¹‹åé‡å¯LXCå®¹å™¨å³å¯æ­£å¸¸è¿è¡Œhappynetå®¢æˆ·ç«¯

## å‡çº§:
1. ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…

2. åœæ­¢happynetæœåŠ¡:
```
$ sudo systemctl stop happynet
```
3. è§£å‹å®‰è£…åŒ…åè¦†ç›–å¯æ‰§è¡Œæ–‡ä»¶:
```
$ sudo cp bin/x64/happynet /usr/local/bin/happynet
```
4. é‡æ–°å¯åŠ¨æœåŠ¡:
```
$ sudo systemctl start happynet
```
## FAQ:

å®¢æˆ·ç«¯æ”¯æŒå“ªäº›å¹³å°?

ç›®å‰æ”¯æŒä¸»æµLinuxå‘è¡Œç‰ˆçš„32ä½åŠ64ä½ç³»ç»Ÿï¼›å¸®åŠ©æ–‡æ¡£ä¸­çš„ç¤ºä¾‹é‡‡ç”¨äº†systemdä½œä¸ºæœåŠ¡ç®¡ç†å·¥å…·ï¼Œæ‚¨å½“ç„¶ä¹Ÿå¯ä»¥ç¼–å†™è‡ªå·±çš„è„šæœ¬ç®¡ç†happynetæœåŠ¡

æˆ‘æ‰€æœ‰è®¾å¤‡ä¸Šçš„ç¨‹åºå·²ç»æ˜¾ç¤ºè¿è¡ŒæˆåŠŸï¼Œä½†æ˜¯æˆ‘Pingä¸é€šå¯¹æ–¹ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

é¦–å…ˆè¯·æ£€æŸ¥æ˜¯å¦å‚æ•°éƒ½æ­£ç¡®é…ç½®äº†ï¼Œç‰¹åˆ«è¦ä¿è¯ "æœåŠ¡ID+æœåŠ¡å¯†é’¥" æ˜¯å¦åœ¨æ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¸€è‡´ï¼Œæœ‰å¾ˆå¤šæ—¶å€™æ˜¯æˆ‘ä»¬å¤ªç²—å¿ƒ;

å…¶æ¬¡è¯·æ£€æŸ¥è‡ªå·±çš„æœºå™¨æ˜¯å¦å¼€å¯äº†é˜²ç«å¢™ï¼Œå¯ä»¥å…ˆç”¨æœºå™¨çš„åŸæœ‰IP Pingä¸€ä¸‹ï¼Œçœ‹çœ‹é€šä¸é€šï¼›

æœ€åè¯·ä»”ç»†æ£€æŸ¥Happynetçš„è¾“å‡ºLogï¼Œçœ‹æ˜¯å¦æœ‰"[OK]"çš„è¿æ¥æˆåŠŸè¾“å‡ºï¼Œå¦‚æœæ²¡æœ‰ï¼Œæœ€å¤§çš„å¯èƒ½æ˜¯æ‚¨çŸ­æ—¶é—´å†…å¤šæ¬¡è¿æ¥ï¼Œè¢«ç³»ç»Ÿåˆ¤æ–­ä¸ºæ¶æ„æ‰«æç¦æ­¢äº†ï¼›æ­¤æ—¶æ‚¨å…ˆâ€œåœæ­¢æœåŠ¡â€ï¼Œç„¶åç­‰å¾…2åˆ†é’Ÿï¼Œå†æ¬¡é‡è¿å³å¯

è¿˜æœ‰å…¶å®ƒé—®é¢˜ï¼Ÿ

æ²¡å…³ç³»ï¼Œè¯·åˆ° äº¤æµè®ºå› å‘æˆ‘ä»¬åé¦ˆé—®é¢˜ï¼Œè°¢è°¢æ‚¨çš„åŒ…å®¹å’Œæ”¯æŒï¼
